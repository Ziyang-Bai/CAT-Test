<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAT Test v0.1 - Private</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        #results { margin-top: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; background: #f9f9f9; }
        .pass { color: green; }
        .fail { color: red; }
        .details { margin-top: 10px; font-size: 0.9em; display: none; }
        .expand-btn { cursor: pointer; color: blue; text-decoration: underline; margin-left: 10px; font-size: 0.9em; }
    </style>
</head>
<body>
    <h1>CAT Test v0.1 - Private</h1>
    <p>This is a browser compatibility and feature test. Click "Run Tests" to evaluate your browser's capabilities.</p>
    <button id="runTestsButton">Run Tests</button>
    <div id="results"></div>
    <p>View the project on <a href="https://github.com/Ziyang-Bai/CAT-Test" target="_blank">GitHub</a>.</p>

    <script>
        function runTests() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>Running Tests...</h2>';

            const tests = [
                { 
                    name: "Async/Await Support", 
                    test: function() {
                        try {
                            const result = typeof (async function() {}).constructor === "function";
                            return { result: result, logs: ["Checking async/await support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in async/await check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports modern JavaScript async/await syntax for asynchronous programming."
                },
                { 
                    name: "Canvas Support", 
                    test: function() {
                        try {
                            const result = !!document.createElement('canvas').getContext;
                            return { result: result, logs: ["Canvas support detected: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in canvas support check: " + e.message] };
                        }
                    },
                    details: "Checks if the HTML5 Canvas API is available for drawing graphics and animations."
                },
                { 
                    name: "CSS Grid Support", 
                    test: function() {
                        try {
                            const result = CSS.supports("display", "grid");
                            return { result: result, logs: ["CSS Grid support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSS Grid check: " + e.message] };
                        }
                    },
                    details: "Verifies if the browser supports CSS Grid for advanced layout designs."
                },
                { 
                    name: "CSS Variables Support", 
                    test: function() {
                        try {
                            const result = CSS.supports("color", "var(--primary-color)");
                            return { result: result, logs: ["CSS Variables support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSS Variables check: " + e.message] };
                        }
                    },
                    details: "Ensures the browser supports CSS custom properties (variables)."
                },
                { 
                    name: "HTTPS Connection", 
                    test: function() {
                        try {
                            const result = location.protocol === 'https:';
                            return { result: result, logs: ["HTTPS connection: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in HTTPS check: " + e.message] };
                        }
                    },
                    details: "Confirms if the page is loaded over a secure HTTPS connection."
                },
                { 
                    name: "WebAssembly Support", 
                    test: function() {
                        try {
                            const result = typeof WebAssembly !== "undefined";
                            return { result: result, logs: ["WebAssembly support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in WebAssembly check: " + e.message] };
                        }
                    },
                    details: "Checks for WebAssembly, which enables high-performance applications in the browser."
                },
                { 
                    name: "WebRTC Support", 
                    test: function() {
                        try {
                            const result = 'RTCPeerConnection' in window;
                            return { result: result, logs: ["WebRTC support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in WebRTC check: " + e.message] };
                        }
                    },
                    details: "Tests for WebRTC, allowing peer-to-peer communication, such as video calls."
                },
                { 
                    name: "Service Worker Support", 
                    test: function() {
                        try {
                            const result = 'serviceWorker' in navigator;
                            return { result: result, logs: ["Service Worker support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in Service Worker check: " + e.message] };
                        }
                    },
                    details: "Verifies if the browser supports Service Workers for offline capabilities and push notifications."
                },
                { 
                    name: "CSP Support", 
                    test: function() {
                        try {
                            const meta = document.createElement('meta');
                            meta.httpEquiv = "Content-Security-Policy";
                            meta.content = "default-src 'self'";
                            document.head.appendChild(meta);
                            const result = true;
                            return { result: result, logs: ["CSP meta tag added."] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSP check: " + e.message] };
                        }
                    },
                    details: "Tests Content Security Policy (CSP) implementation to prevent unsafe resources."
                },
                { 
                    name: "LocalStorage Support", 
                    test: function() {
                        try {
                            const result = 'localStorage' in window && window['localStorage'] !== null;
                            return { result: result, logs: ["LocalStorage support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in LocalStorage check: " + e.message] };
                        }
                    },
                    details: "Checks if the browser supports LocalStorage for storing data locally."
                },
                { 
                    name: "IndexedDB Support", 
                    test: function() {
                        try {
                            const result = 'indexedDB' in window;
                            return { result: result, logs: ["IndexedDB support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in IndexedDB check: " + e.message] };
                        }
                    },
                    details: "Verifies if the browser supports IndexedDB for storing large amounts of structured data."
                },
                { 
                    name: "Geolocation API Support", 
                    test: function() {
                        try {
                            const result = 'geolocation' in navigator;
                            return { result: result, logs: ["Geolocation API support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in Geolocation API check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports the Geolocation API for accessing the device's location."
                },
                { 
                    name: "WebSockets Support", 
                    test: function() {
                        try {
                            const result = 'WebSocket' in window;
                            return { result: result, logs: ["WebSockets support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in WebSockets check: " + e.message] };
                        }
                    },
                    details: "Checks if the browser supports WebSockets for real-time communication."
                }
            ];

            results.innerHTML = ''; // Clear previous results
            for (var i = 0; i < tests.length; i++) {
                var test = tests[i];
                var resultData;
                try {
                    resultData = test.test(); // Execute test
                } catch (e) {
                    resultData = { result: false, logs: ["Error running test: " + e.message] }; // Handle errors
                }

                var div = document.createElement('div');
                div.className = 'test ' + (resultData.result ? 'pass' : 'fail');
                div.innerHTML = '\
                    <span>' + test.name + ': ' + (resultData.result ? 'PASS' : 'FAIL') + '</span>\
                    <span class="expand-btn" onclick="toggleDetails(this)">[Details]</span>\
                    <div class="details">\
                        <p>' + test.details + '</p>\
                        <pre>' + resultData.logs.join("\n") + '</pre>\
                    </div>\
                ';
                results.appendChild(div);
            }

            // Add summary
            var totalTests = tests.length;
            var passedTests = document.querySelectorAll('.pass').length;
            var summary = document.createElement('div');
            summary.innerHTML = '<h3>Summary: ' + passedTests + '/' + totalTests + ' tests passed</h3>';
            results.appendChild(summary);

            // Add user agent information
            var uaInfo = document.createElement('div');
            uaInfo.innerHTML = '<h3>User Agent: ' + navigator.userAgent + '</h3>';
            results.insertBefore(uaInfo, results.firstChild);
        }

        // Toggle detailed information
        function toggleDetails(btn) {
            var detailsDiv = btn.nextElementSibling;
            detailsDiv.style.display = detailsDiv.style.display === 'block' ? 'none' : 'block';
        }

        // Polyfill for IE support
        if (!String.prototype.includes) {
            String.prototype.includes = function(search, start) {
                'use strict';
                if (typeof start !== 'number') {
                    start = 0;
                }
                if (start + search.length > this.length) {
                    return false;
                } else {
                    return this.indexOf(search, start) !== -1;
                }
            };
        }

        // Bind runTests to the button
        document.getElementById('runTestsButton').addEventListener('click', runTests);
    </script>
</body>
</html>
