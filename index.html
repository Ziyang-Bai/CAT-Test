<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAT Test v0.5.1 - Public</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        #results { margin-top: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; background: #f9f9f9; }
        .pass { color: green; }
        .fail { color: red; }
        .details { margin-top: 10px; font-size: 0.9em; display: none; }
        .expand-btn { cursor: pointer; color: blue; text-decoration: underline; margin-left: 10px; font-size: 0.9em; }
        #progress { margin-top: 20px; }
        #scoreBarContainer { position: absolute; right: 20px; top: 20px; display: flex; align-items: flex-end; }
        .scoreStep { width: 50px; background: #ccc; margin-right: 5px; }
        .scoreStep.red { background: red; height: 30px; }
        .scoreStep.orange { background: orange; height: 40px; }
        .scoreStep.green { background: green; height: 50px; }
        .scoreStep.blink { animation: blink 1s infinite; }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        #scoreLabel { font-size: 2em; margin-right: 10px; }
    </style>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; script-src 'self' 'unsafe-inline';">
</head>
<body>
    <h1>CAT Test v0.5.1 - Public</h1>
    <p>This is a browser compatibility and feature test. Click "Run Tests" to evaluate your browser's capabilities.</p>
    <p><strong>Note:</strong> This test includes a check for Content Security Policy (CSP) which may affect the loading of certain resources for security purposes.</p>
    <div style="display: flex; align-items: center;">
        <button id="runTestsButton">Run Tests</button>
    </div>
    <div id="progress"></div>
    <div id="results"></div>
    <div id="scoreBarContainer">
        <div id="scoreLabel">D</div>
        <div id="scoreStep1" class="scoreStep red"></div>
        <div id="scoreStep2" class="scoreStep orange"></div>
        <div id="scoreStep3" class="scoreStep green"></div>
    </div>
    <p>View the project on <a href="https://github.com/elefish-top/CAT-Test" target="_blank">GitHub</a>.</p>
    <p id="ipAddress">Fetching IP address...</p>
    <p>Additional Tests:</p>
    <ul>
        <li><a href="IEtest.html" target="_blank">IE Test</a></li>
        <li><a href="ES6test.html" target="_blank">ES6 Test</a></li>
    </ul>

    <script>
        function runTests() {
            var results = document.getElementById('results');
            var progress = document.getElementById('progress');
            results.innerHTML = '<h2>Running Tests...</h2>';
            progress.innerHTML = '';

            // Fetch and display the user's IP address
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://api.ipify.org?format=json', true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var data = JSON.parse(xhr.responseText);
                    document.getElementById('ipAddress').textContent = 'Your IP Address: ' + data.ip;
                } else if (xhr.readyState == 4) {
                    document.getElementById('ipAddress').textContent = 'Unable to fetch IP address.';
                }
            };
            xhr.send();

            var tests = [
                { 
                    name: "Async/Await Support", 
                    test: function() {
                        try {
                            var result = typeof (async function() {}).constructor === "function";
                            return { result: result, logs: ["Checking async/await support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in async/await check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports modern JavaScript async/await syntax for asynchronous programming."
                },
                { 
                    name: "Canvas Support", 
                    test: function() {
                        try {
                            var result = !!document.createElement('canvas').getContext;
                            return { result: result, logs: ["Canvas support detected: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in canvas support check: " + e.message] };
                        }
                    },
                    details: "Checks if the HTML5 Canvas API is available for drawing graphics and animations."
                },
                { 
                    name: "CSS Grid Support", 
                    test: function() {
                        try {
                            var result = CSS.supports("display", "grid");
                            return { result: result, logs: ["CSS Grid support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSS Grid check: " + e.message] };
                        }
                    },
                    details: "Verifies if the browser supports CSS Grid for advanced layout designs."
                },
                { 
                    name: "CSS Variables Support", 
                    test: function() {
                        try {
                            var result = CSS.supports("color", "var(--primary-color)");
                            return { result: result, logs: ["CSS Variables support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSS Variables check: " + e.message] };
                        }
                    },
                    details: "Ensures the browser supports CSS custom properties (variables)."
                },
                { 
                    name: "HTTPS Connection", 
                    test: function() {
                        try {
                            var result = location.protocol === 'https:';
                            return { result: result, logs: ["HTTPS connection: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in HTTPS check: " + e.message] };
                        }
                    },
                    details: "Confirms if the page is loaded over a secure HTTPS connection. This check will not work if you are accessing locally, or if the server does not have a valid SSL certificate."

                },
                { 
                    name: "WebAssembly Support", 
                    test: function() {
                        try {
                            var result = typeof WebAssembly !== "undefined";
                            return { result: result, logs: ["WebAssembly support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in WebAssembly check: " + e.message] };
                        }
                    },
                    details: "Checks for WebAssembly, which enables high-performance applications in the browser."
                },
                { 
                    name: "WebRTC Support", 
                    test: function() {
                        try {
                            var result = 'RTCPeerConnection' in window;
                            return { result: result, logs: ["WebRTC support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in WebRTC check: " + e.message] };
                        }
                    },
                    details: "Tests for WebRTC, allowing peer-to-peer communication, such as video calls."
                },
                { 
                    name: "Service Worker Support", 
                    test: function() {
                        try {
                            var result = 'serviceWorker' in navigator;
                            return { result: result, logs: ["Service Worker support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in Service Worker check: " + e.message] };
                        }
                    },
                    details: "Verifies if the browser supports Service Workers for offline capabilities and push notifications."
                },
                { 
                    name: "CSP Support", 
                    test: function() {
                        try {
                            var meta = document.createElement('meta');
                            meta.httpEquiv = "Content-Security-Policy";
                            meta.content = "default-src 'self'";
                            document.head.appendChild(meta);
                            var result = true;
                            return { result: result, logs: ["CSP meta tag added."] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSP check: " + e.message] };
                        }
                    },
                    details: "Tests Content Security Policy (CSP) implementation to prevent unsafe resources."
                },
                { 
                    name: "LocalStorage Support", 
                    test: function() {
                        try {
                            var result = 'localStorage' in window && window['localStorage'] !== null;
                            return { result: result, logs: ["LocalStorage support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in LocalStorage check: " + e.message] };
                        }
                    },
                    details: "Checks if the browser supports LocalStorage for storing data locally."
                },
                { 
                    name: "IndexedDB Support", 
                    test: function() {
                        try {
                            var result = 'indexedDB' in window;
                            return { result: result, logs: ["IndexedDB support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in IndexedDB check: " + e.message] };
                        }
                    },
                    details: "Verifies if the browser supports IndexedDB for storing large amounts of structured data."
                },
                { 
                    name: "Geolocation API Support", 
                    test: function() {
                        try {
                            var result = 'geolocation' in navigator;
                            return { result: result, logs: ["Geolocation API support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in Geolocation API check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports the Geolocation API for accessing the device's location."
                },
                { 
                    name: "WebSockets Support", 
                    test: function() {
                        try {
                            var result = 'WebSocket' in window;
                            return { result: result, logs: ["WebSockets support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in WebSockets check: " + e.message] };
                        }
                    },
                    details: "Checks if the browser supports WebSockets for real-time communication."
                },
                { 
                    name: "Flexbox Support", 
                    test: function() {
                        try {
                            var result = CSS.supports("display", "flex");
                            return { result: result, logs: ["Flexbox support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in Flexbox check: " + e.message] };
                        }
                    },
                    details: "Verifies if the browser supports CSS Flexbox for flexible layouts."
                },
                {
                    name: "ES6 Support",
                    test: function() {
                        var logs = [];
                        try {
                            // Test for let/const
                            var letTest = true;
                            var constTest = true;

                            // Test for arrow functions
                            var arrowFuncTest = function() { return true; };

                            // Test for template literals
                            var templateLiteralTest = "" + letTest;

                            // Test for classes
                            var ES6ClassTest = function() {};

                            // Test for default parameters
                            var defaultParamTest = function(param) { if (param === undefined) param = true; return param; };

                            // Test for promises
                            var promiseTest = new Promise(function(resolve) { resolve(true); });

                            // If no errors were thrown, the browser supports ES6
                            logs.push("ES6 features support: PASS");
                            return { result: true, logs: logs };
                        } catch (e) {
                            logs.push("Error in ES6 check: " + e.message);
                            return { result: false, logs: logs };
                        }
                    },
                    details: "Tests if the browser supports ES6 (ECMAScript 2015) features."
                },
                {
                    name: "WebGL Support",
                    test: function() {
                        try {
                            var canvas = document.createElement('canvas');
                            var result = !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
                            return { result: result, logs: ["WebGL support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in WebGL check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports WebGL for 3D graphics rendering."
                },
                {
                    name: "SVG Support",
                    test: function() {
                        try {
                            var result = !!document.createElementNS && !!document.createElementNS("http://www.w3.org/2000/svg", "svg").createSVGRect;
                            return { result: result, logs: ["SVG support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in SVG check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports SVG (Scalable Vector Graphics) for rendering vector images."
                },
                { 
                    name: "Clipboard API", 
                    test: function() {
                        try {
                            var result = 'clipboard' in navigator;
                            return { result: result, logs: ["Clipboard API support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in Clipboard API check: " + e.message] };
                        }
                    },
                    details: "Checks if the browser supports the Clipboard API for reading and writing content to the clipboard."
                },
                { 
                    name: "DOM Manipulation", 
                    test: function() {
                        try {
                            var div = document.createElement('div');
                            div.innerHTML = '<p>Test</p>';
                            document.body.appendChild(div);
                            var result = div.querySelector('p').textContent === 'Test';
                            document.body.removeChild(div);
                            return { result: result, logs: ["DOM manipulation: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in DOM manipulation check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports basic DOM manipulation."
                },
                { 
                    name: "JavaScript Support", 
                    test: function() {
                        try {
                            var result = typeof Function === 'function' && typeof Object === 'function';
                            return { result: result, logs: ["JavaScript support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in JavaScript support check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports basic JavaScript language features."
                },
                { 
                    name: "CSS Support", 
                    test: function() {
                        try {
                            var result = CSS.supports("display", "block");
                            return { result: result, logs: ["CSS support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSS support check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports basic CSS features."
                },
                { 
                    name: "Web Fonts Support", 
                    test: function() {
                        try {
                            var style = document.createElement('style');
                            style.textContent = "@font-face { font-family: 'TestFont'; src: url('data:font/woff2;base64,d09GMgABAAAAAA...') format('woff2'); }";
                            document.head.appendChild(style);
                            var div = document.createElement('div');
                            div.style.fontFamily = 'TestFont';
                            document.body.appendChild(div);
                            var result = getComputedStyle(div).fontFamily === 'TestFont';
                            document.body.removeChild(div);
                            document.head.removeChild(style);
                            return { result: result, logs: ["Web Fonts support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in Web Fonts support check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports @font-face rule and custom fonts."
                },
                {
                    name: "Data URI Support",
                    test: function() {
                        var logs = [];
                        try {
                            // Create a simple Data URI (Base64-encoded image)
                            var dataUri = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z/C/HwAGgwJ/l6VfMgAAAABJRU5ErkJggg==";
                            
                            // Create an Image element
                            var img = new Image();
                            img.src = dataUri;

                            // Check if the browser can load the Data URI
                            img.onload = function() {
                                logs.push("Data URI is supported: PASS");
                            };
                            img.onerror = function() {
                                logs.push("Data URI support failed: FAIL");
                            };

                            // Test with other Data URI formats
                            var textUri = "data:text/plain;charset=utf-8,Hello%20World!";
                            if (!textUri.startsWith("data:text/plain")) {
                                throw new Error("Plain text Data URI check failed.");
                            }

                            // No errors encountered, Data URI is supported
                            logs.push("Plain text Data URI is supported: PASS");
                            return { result: true, logs: logs };
                        } catch (e) {
                            logs.push("Error in Data URI check: " + e.message);
                            return { result: false, logs: logs };
                        }
                    },
                    details: "Tests if the browser supports Data URI schemes for embedding inline data."
                },
                { 
                    name: "XMLHttpRequest Support", 
                    test: function() {
                        try {
                            var result = typeof XMLHttpRequest !== 'undefined';
                            return { result: result, logs: ["XMLHttpRequest support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in XMLHttpRequest support check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports AJAX requests using XMLHttpRequest."
                },
                { 
                    name: "HTML5 Support", 
                    test: function() {
                        try {
                            var result = typeof document.createElement('canvas').getContext === 'function';
                            return { result: result, logs: ["HTML5 support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in HTML5 support check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports new HTML5 features."
                },
                { 
                    name: "DOM Level 2 Events", 
                    test: function() {
                        try {
                            var result = !!document.addEventListener;
                            return { result: result, logs: ["DOM Level 2 Events support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in DOM Level 2 Events check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports DOM Level 2 Events."
                },
                { 
                    name: "SVG Animation", 
                    test: function() {
                        try {
                            var result = !!document.createElementNS && !!document.createElementNS("http://www.w3.org/2000/svg", "animate").beginElement;
                            return { result: result, logs: ["SVG Animation support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in SVG Animation check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports SVG animations."
                },
                { 
                    name: "SMIL Animation", 
                    test: function() {
                        try {
                            var result = !!document.createElementNS && !!document.createElementNS("http://www.w3.org/2000/svg", "animate").beginElement;
                            return { result: result, logs: ["SMIL Animation support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in SMIL Animation check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports SMIL animations."
                },
                { 
                    name: "HTML5 Video", 
                    test: function() {
                        try {
                            var result = !!document.createElement('video').canPlayType;
                            return { result: result, logs: ["HTML5 Video support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in HTML5 Video check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports HTML5 video."
                },
                { 
                    name: "HTML5 Audio", 
                    test: function() {
                        try {
                            var result = !!document.createElement('audio').canPlayType;
                            return { result: result, logs: ["HTML5 Audio support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in HTML5 Audio check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports HTML5 audio."
                },
                { 
                    name: "CSS Transitions", 
                    test: function() {
                        try {
                            var result = CSS.supports("transition", "all 1s");
                            return { result: result, logs: ["CSS Transitions support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSS Transitions check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports CSS transitions."
                },
                { 
                    name: "CSS Animations", 
                    test: function() {
                        try {
                            var result = CSS.supports("animation", "name 1s");
                            return { result: result, logs: ["CSS Animations support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSS Animations check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports CSS animations."
                },
                { 
                    name: "CSS 3D Transforms", 
                    test: function() {
                        try {
                            var result = CSS.supports("transform", "rotateY(180deg)");
                            return { result: result, logs: ["CSS 3D Transforms support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSS 3D Transforms check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports CSS 3D transforms."
                },
                { 
                    name: "CSS Gradients", 
                    test: function() {
                        try {
                            var result = CSS.supports("background", "linear-gradient(to right, red, blue)");
                            return { result: result, logs: ["CSS Gradients support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in CSS Gradients check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports CSS gradients."
                },
                { 
                    name: "MathML Support", 
                    test: function() {
                        try {
                            var math = document.createElementNS("http://www.w3.org/1998/Math/MathML", "math");
                            var result = math.namespaceURI === "http://www.w3.org/1998/Math/MathML";
                            return { result: result, logs: ["MathML support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in MathML check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports MathML for displaying mathematical notations."
                },
                { 
                    name: "MPEG-4 Support", 
                    test: function() {
                        try {
                            var video = document.createElement('video');
                            var result = !!video.canPlayType && video.canPlayType('video/mp4; codecs="mp4v.20.8"') !== "";
                            return { result: result, logs: ["MPEG-4 support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in MPEG-4 check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports MPEG-4 video format."
                },
                { 
                    name: "H.264 Support", 
                    test: function() {
                        try {
                            var video = document.createElement('video');
                            var result = !!video.canPlayType && video.canPlayType('video/mp4; codecs="avc1.42E01E"') !== "";
                            return { result: result, logs: ["H.264 support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in H.264 check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports H.264 video format."
                },
                { 
                    name: "Ogg Theora Support", 
                    test: function() {
                        try {
                            var video = document.createElement('video');
                            var result = !!video.canPlayType && video.canPlayType('video/ogg; codecs="theora"') !== "";
                            return { result: result, logs: ["Ogg Theora support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in Ogg Theora check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports Ogg Theora video format."
                },
                { 
                    name: "WebM Support", 
                    test: function() {
                        try {
                            var video = document.createElement('video');
                            var result = !!video.canPlayType && video.canPlayType('video/webm; codecs="vp8, vorbis"') !== "";
                            return { result: result, logs: ["WebM support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in WebM check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports WebM video format."
                },
                { 
                    name: "details Element", 
                    test: function() {
                        try {
                            var result = 'open' in document.createElement('details');
                            return { result: result, logs: ["details element support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in details element check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports the HTML5 details element."
                },
                { 
                    name: "summary Element", 
                    test: function() {
                        try {
                            var details = document.createElement('details');
                            var summary = document.createElement('summary');
                            details.appendChild(summary);
                            document.body.appendChild(details);
                            var result = details.open === false;
                            document.body.removeChild(details);
                            return { result: result, logs: ["summary element support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in summary element check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports the HTML5 summary element."
                },
                { 
                    name: "command Element", 
                    test: function() {
                        try {
                            var result = 'type' in document.createElement('command');
                            return { result: result, logs: ["command element support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in command element check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports the HTML5 command element."
                },
                { 
                    name: "menu Element of Type List", 
                    test: function() {
                        try {
                            var menu = document.createElement('menu');
                            menu.type = 'list';
                            var result = menu.type === 'list';
                            return { result: result, logs: ["menu element of type list support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in menu element of type list check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports the HTML5 menu element of type list."
                },
                { 
                    name: "menu Element of Type Toolbar", 
                    test: function() {
                        try {
                            var menu = document.createElement('menu');
                            menu.type = 'toolbar';
                            var result = menu.type === 'toolbar';
                            return { result: result, logs: ["menu element of type toolbar support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in menu element of type toolbar check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports the HTML5 menu element of type toolbar."
                },
                { 
                    name: "menu Element of Type Context", 
                    test: function() {
                        try {
                            var menu = document.createElement('menu');
                            menu.type = 'context';
                            var result = menu.type === 'context';
                            return { result: result, logs: ["menu element of type context support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in menu element of type context check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports the HTML5 menu element of type context."
                },
                { 
                    name: "Dynamic Markup Insertion", 
                    test: function() {
                        try {
                            var div = document.createElement('div');
                            div.innerHTML = '<p>Test</p>';
                            var result = div.querySelector('p').textContent === 'Test';
                            return { result: result, logs: ["Dynamic markup insertion: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in dynamic markup insertion check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports dynamic markup insertion."
                },
                { 
                    name: "Microdata", 
                    test: function() {
                        try {
                            var div = document.createElement('div');
                            div.innerHTML = '<div itemscope itemtype="http://schema.org/Person"><span itemprop="name">John Doe</span></div>';
                            var result = div.querySelector('[itemprop="name"]').textContent === 'John Doe';
                            return { result: result, logs: ["Microdata support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in microdata check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports microdata."
                },
                { 
                    name: "Sandbox Attribute", 
                    test: function() {
                        try {
                            var iframe = document.createElement('iframe');
                            iframe.setAttribute('sandbox', 'allow-scripts');
                            var result = iframe.sandbox.length > 0;
                            return { result: result, logs: ["Sandbox attribute support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in sandbox attribute check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports the sandbox attribute on iframes."
                },
                { 
                    name: "Seamless Attribute", 
                    test: function() {
                        try {
                            var iframe = document.createElement('iframe');
                            iframe.seamless = true;
                            var result = iframe.seamless === true;
                            return { result: result, logs: ["Seamless attribute support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in seamless attribute check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports the seamless attribute on iframes."
                },
                { 
                    name: "iframe with Inline Contents", 
                    test: function() {
                        try {
                            var iframe = document.createElement('iframe');
                            var result = typeof iframe !== 'undefined';
                            return { result: result, logs: ["iframe with inline contents support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in iframe with inline contents check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports iframes with inline contents."
                },
                { 
                    name: "Cross-document Messaging", 
                    test: function() {
                        try {
                            var result = !!window.postMessage;
                            return { result: result, logs: ["Cross-document messaging support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in cross-document messaging check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports cross-document messaging using postMessage."
                },
                { 
                    name: "Web Notifications", 
                    test: function() {
                        try {
                            var result = 'Notification' in window;
                            return { result: result, logs: ["Web Notifications support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in Web Notifications check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports Web Notifications."
                },
                { 
                    name: "Access to Webcam", 
                    test: function() {
                        try {
                            var result = !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
                            return { result: result, logs: ["Access to webcam support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in access to webcam check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports access to the webcam using getUserMedia."
                },
                { 
                    name: "Mutation Observer", 
                    test: function() {
                        try {
                            var result = !!window.MutationObserver;
                            return { result: result, logs: ["Mutation Observer support: " + (result ? "PASS" : "FAIL")] };
                        } catch (e) {
                            return { result: false, logs: ["Error in Mutation Observer check: " + e.message] };
                        }
                    },
                    details: "Tests if the browser supports Mutation Observers for observing changes to the DOM."
                }
            ];

            results.innerHTML = ''; // Clear previous results
            var scoreElement = document.getElementById('score');
            var totalTests = tests.length;
            var passedTests = 0;

            for (var i = 0; i < tests.length; i++) {
                (function(test, index) {
                    setTimeout(function() {
                        var resultData;
                        try {
                            resultData = test.test(); // Execute test
                        } catch (e) {
                            resultData = { result: false, logs: ["Error running test: " + e.message] }; // Handle errors
                        }

                        var div = document.createElement('div');
                        div.className = 'test ' + (resultData.result ? 'pass' : 'fail');
                        div.innerHTML = '\
                            <span>' + test.name + ': ' + (resultData.result ? 'PASS' : 'FAIL') + '</span>\
                            <span class="expand-btn">[Details]</span>\
                            <div class="details">\
                                <p>' + test.details + '</p>\
                                <pre>' + (resultData.logs ? resultData.logs.join("\n") : '') + '</pre>\
                            </div>\
                        ';
                        results.appendChild(div);

                        // Update progress
                        progress.innerHTML = 'Progress: ' + (index + 1) + '/' + tests.length + ' tests completed';

                        if (resultData.result) {
                            passedTests++;
                        }
                        var scorePercentage = Math.round((passedTests / totalTests) * 100);
                        updateScoreBar(scorePercentage);

                        // Bind event to the expand button
                        var expandButton = div.querySelector('.expand-btn');
                        expandButton.addEventListener('click', function() {
                            toggleDetails(expandButton);
                        });

                    }, i * 100); // Delay each test to simulate progress
                })(tests[i], i);
            }

            // Add summary
            setTimeout(function() {
                var totalTests = tests.length;
                var passedTests = document.querySelectorAll('.pass').length;
                var summary = document.createElement('div');
                summary.innerHTML = '<h3>Summary: ' + passedTests + '/' + totalTests + ' tests passed</h3>';
                results.appendChild(summary);

                // Add user agent information
                var uaInfo = document.createElement('div');
                uaInfo.innerHTML = '<h3>User Agent: ' + navigator.userAgent + '</h3>';
                results.insertBefore(uaInfo, results.firstChild);
            }, tests.length * 100);
        }

        function updateScoreBar(score) {
            var step1 = document.getElementById('scoreStep1');
            var step2 = document.getElementById('scoreStep2');
            var step3 = document.getElementById('scoreStep3');
            var scoreLabel = document.getElementById('scoreLabel');

            step1.className = 'scoreStep red';
            step2.className = 'scoreStep orange';
            step3.className = 'scoreStep green';

            if (score === 100) {
                step1.classList.add('blink');
                step2.classList.add('blink');
                step3.classList.add('blink');
                scoreLabel.textContent = 'AA';
            } else if (score >= 80) {
                step1.classList.remove('blink');
                step2.classList.remove('blink');
                step3.classList.remove('blink');
                scoreLabel.textContent = 'A';
            } else if (score >= 60) {
                step1.classList.remove('blink');
                step2.classList.remove('blink');
                step3.classList.remove('green');
                scoreLabel.textContent = 'B';
            } else if (score >= 40) {
                step1.classList.remove('blink');
                step2.classList.remove('orange');
                step3.classList.remove('green');
                scoreLabel.textContent = 'C';
            } else {
                step1.classList.remove('blink');
                step2.classList.remove('orange');
                step3.classList.remove('green');
                scoreLabel.textContent = 'D';
            }
        }

        function setScoreLevel(level) {
            var step1 = document.getElementById('scoreStep1');
            var step2 = document.getElementById('scoreStep2');
            var step3 = document.getElementById('scoreStep3');
            var scoreLabel = document.getElementById('scoreLabel');

            step1.className = 'scoreStep red';
            step2.className = 'scoreStep orange';
            step3.className = 'scoreStep green';

            if (level === 'AA') {
                step1.classList.add('blink');
                step2.classList.add('blink');
                step3.classList.add('blink');
                scoreLabel.textContent = 'AA';
            } else if (level === 'A') {
                step1.classList.remove('blink');
                step2.classList.remove('blink');
                step3.classList.remove('blink');
                scoreLabel.textContent = 'A';
            } else if (level === 'B') {
                step1.classList.remove('blink');
                step2.classList.remove('blink');
                step3.classList.remove('green');
                scoreLabel.textContent = 'B';
            } else if (level === 'C') {
                step1.classList.remove('blink');
                step2.classList.remove('orange');
                step3.classList.remove('green');
                scoreLabel.textContent = 'C';
            } else {
                step1.classList.remove('blink');
                step2.classList.remove('orange');
                step3.classList.remove('green');
                scoreLabel.textContent = 'D';
            }
        }

        // Toggle detailed information
        function toggleDetails(btn) {
            var detailsDiv = btn.closest('.test').querySelector('.details');
            if (detailsDiv) {
                console.log("Toggling details..."); // 调试输出
                if (detailsDiv.style.display === 'block') {
                    detailsDiv.style.display = 'none';
                    btn.textContent = '[Details]';  // 更新按钮文本
                } else {
                    detailsDiv.style.display = 'block';
                    btn.textContent = '[Hide]';  // 更新按钮文本
                }
            }
        }

        // Bind runTests to the button
        document.getElementById('runTestsButton').addEventListener('click', runTests);
    </script>
</body>
</html>
